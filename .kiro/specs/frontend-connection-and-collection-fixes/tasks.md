# 前端连接错误和数据采集功能修复实施任务

## 实施计划

本任务列表将系统性地修复 JavaScript 错误和恢复数据采集功能，确保系统能够正常运行。

## 任务列表

- [ ] 1. 修复 ApiClient 类定义和实例化问题

  - 修复 api.js 中的 ApiClient 类作用域问题，确保类可以被正确实例化
  - 将 ApiClient 类定义为 window.ApiClient 以确保全局访问
  - 修复 window.api 实例创建，使用 window.ApiClient 构造函数
  - 添加类型检查和错误处理，防止重复定义
  - _需求: 1.1, 1.2, 1.3_

- [ ] 2. 修复 main.js 中的 API 调用引用

  - 将所有 api.方法调用改为 window.api.方法调用
  - 修复 checkSystemHealth、loadSystemInfo、loadSystemPerformance 等函数中的 API 调用
  - 确保所有 API 调用都使用正确的 window.api 引用
  - 添加 API 可用性检查，防止 undefined 错误
  - _需求: 1.4, 1.5_

- [ ] 3. 改善系统初始化和错误处理机制

  - 修复系统初始化流程，添加依赖检查
  - 实现更详细的错误分类和处理
  - 添加错误恢复机制和用户友好的错误提示
  - 防止重复的错误信息输出到控制台
  - 改善系统状态显示，提供具体的连接状态信息
  - _需求: 1.6, 3.1, 3.2, 4.1, 4.2_

- [ ] 4. 添加数据采集导航菜单项

  - 在 index.html 的导航栏中添加"数据采集"菜单项
  - 确保菜单项指向正确的 collection 页面
  - 修复页面 ID 冲突，将重复的 collection-page 分离
  - 验证导航功能和页面切换正常工作
  - _需求: 2.1, 5.1_

- [ ] 5. 整理和修复数据采集页面内容

  - 合并重复的数据采集页面定义
  - 确保数据采集配置表单完整可用
  - 验证采集频率设置功能正常工作
  - 修复采集状态显示和控制按钮
  - _需求: 2.2, 2.3, 5.2_

- [ ] 6. 实现数据采集配置功能

  - 确保采集频率配置 API 调用正常工作
  - 实现配置验证和保存功能
  - 添加性能影响警告提示
  - 实现暂停/恢复采集功能
  - 添加配置重置功能
  - _需求: 2.4, 2.5, 2.6, 2.7_

- [ ] 7. 创建 JavaScript 错误监控和调试工具

  - 创建测试页面验证 API 修复效果
  - 实现全局错误监控机制
  - 添加调试信息输出功能
  - 创建系统健康检查工具
  - _需求: 3.3, 3.4, 4.3_

- [ ] 8. 优化脚本加载和缓存处理

  - 验证脚本加载顺序正确
  - 添加脚本加载状态检查
  - 实现防重复加载机制
  - 提供缓存清除指导
  - _需求: 4.4, 4.5_

- [ ] 9. 完善系统状态显示和用户反馈

  - 改善导航栏下方的系统状态显示
  - 实现详细的连接状态检查
  - 添加后端服务状态监控
  - 提供系统问题的解决建议
  - _需求: 3.5, 4.1, 5.3_

- [ ] 10. 进行全面测试和验证
  - 测试所有 JavaScript 修复是否生效
  - 验证数据采集功能完整可用
  - 进行浏览器兼容性测试
  - 验证错误处理和恢复机制
  - 确认系统整体稳定性
  - _需求: 5.4, 5.5_

## 验收标准

### JavaScript 错误修复验收

- [ ] 浏览器控制台不再出现"ReferenceError: ApiClient is not defined"错误
- [ ] window.api 实例成功创建，所有 API 方法可正常调用
- [ ] 系统初始化过程无 JavaScript 错误
- [ ] 导航栏状态显示"系统正常"而非"连接失败"

### 数据采集功能验收

- [ ] 导航栏中存在"数据采集"菜单项
- [ ] 点击菜单项可正常进入数据采集配置页面
- [ ] 采集频率设置表单功能正常
- [ ] 配置保存、暂停/恢复功能正常工作
- [ ] 系统性能警告提示正常显示

### 系统稳定性验收

- [ ] 页面刷新后功能正常
- [ ] 多次操作无重复错误
- [ ] 错误处理机制有效
- [ ] 用户体验友好

## 注意事项

1. **修复顺序**：必须按照任务顺序执行，先修复基础的 JavaScript 错误，再处理功能性问题
2. **测试验证**：每个任务完成后都要进行测试验证，确保修复有效
3. **备份文件**：修改前备份原始文件，以便出现问题时快速回滚
4. **浏览器缓存**：修改后建议清除浏览器缓存，确保加载最新文件
5. **错误监控**：持续监控浏览器控制台，确保无新的错误产生
