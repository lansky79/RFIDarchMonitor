<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>采集和维护功能测试</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container-fluid p-4">
      <h2>数据采集状态监控测试</h2>

      <!-- 采集状态卡片 -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>采集状态</h6>
              <span id="collectionStatus" class="badge bg-success">运行中</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>CPU使用率</h6>
              <span id="cpuUsage">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>内存使用率</h6>
              <span id="memoryUsage">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>错误计数</h6>
              <span id="errorCount">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 最后采集时间 -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <h6>传感器最后采集</h6>
              <span id="sensorLastCollection">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <h6>RFID最后扫描</h6>
              <span id="rfidLastScan">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 今日统计 -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h6>传感器采集次数</h6>
              <span id="sensorCollectionCount">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card">
            <div class="card-body">
              <h6>RFID扫描次数</h6>
              <span id="rfidScanCount">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 控制按钮 -->
      <div class="row mb-4">
        <div class="col-md-12">
          <button id="pauseCollectionBtn" class="btn btn-warning me-2">
            暂停采集
          </button>
          <button
            id="resumeCollectionBtn"
            class="btn btn-success me-2"
            style="display: none"
          >
            恢复采集
          </button>
          <button id="refreshStatusBtn" class="btn btn-info">刷新状态</button>
        </div>
      </div>

      <!-- 配置表单 -->
      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h6>采集配置</h6>
            </div>
            <div class="card-body">
              <form id="collectionConfigForm">
                <div class="mb-3">
                  <label for="sensorInterval" class="form-label"
                    >传感器采集间隔(秒)</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="sensorInterval"
                    value="30"
                    min="5"
                    max="300"
                  />
                </div>
                <div class="mb-3">
                  <label for="rfidInterval" class="form-label"
                    >RFID扫描间隔(秒)</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="rfidInterval"
                    value="10"
                    min="1"
                    max="60"
                  />
                </div>
                <button type="submit" class="btn btn-primary">保存配置</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <hr />

      <h2>设备维护记录测试</h2>

      <!-- 维护统计 -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>总维护记录</h6>
              <span id="totalMaintenanceCount">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>已计划</h6>
              <span id="scheduledMaintenanceCount">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>已完成</h6>
              <span id="completedMaintenanceCount">--</span>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h6>逾期</h6>
              <span id="overdueMaintenanceCount">--</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 维护记录表格 -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h6>维护记录</h6>
            </div>
            <div class="card-body">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>设备名称</th>
                    <th>设备类型</th>
                    <th>维护类型</th>
                    <th>计划日期</th>
                    <th>技术员</th>
                    <th>状态</th>
                    <th>费用</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="maintenanceTableBody">
                  <!-- 维护记录将在这里显示 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- 测试按钮 -->
      <div class="row mt-4">
        <div class="col-12">
          <button id="loadMaintenanceBtn" class="btn btn-primary me-2">
            加载维护数据
          </button>
          <button id="loadCollectionBtn" class="btn btn-success me-2">
            加载采集数据
          </button>
        </div>
      </div>
    </div>

    <script>
      // 模拟main.js中的相关函数
      window.currentPage = "collection";

      // 格式化日期时间
      function formatDateTime(datetime) {
        if (!datetime) return "--";
        const date = new Date(datetime);
        return date.toLocaleString("zh-CN");
      }

      // 更新元素内容
      function updateElement(elementId, content, className = null) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = content;
          if (className) {
            element.className = className;
          }
        }
      }

      // 显示成功消息
      function showSuccessMessage(message) {
        alert("成功: " + message);
      }

      // 显示错误消息
      function showErrorMessage(message) {
        alert("错误: " + message);
      }

      // 显示警告消息
      function showWarningMessage(message) {
        alert("警告: " + message);
      }

      // 测试函数
      function testCollectionStatus() {
        console.log("测试采集状态数据...");

        // 生成模拟数据
        const cpuUsage = (Math.random() * 30 + 15).toFixed(1);
        const memoryUsage = (Math.random() * 40 + 30).toFixed(1);

        updateElement("cpuUsage", cpuUsage + "%");
        updateElement("memoryUsage", memoryUsage + "%");

        const now = new Date();
        const sensorLastTime = new Date(now.getTime() - Math.random() * 300000);
        const rfidLastTime = new Date(now.getTime() - Math.random() * 600000);

        updateElement("sensorLastCollection", formatDateTime(sensorLastTime));
        updateElement("rfidLastScan", formatDateTime(rfidLastTime));

        const sensorCollections = Math.floor(Math.random() * 500 + 200);
        const rfidScans = Math.floor(Math.random() * 300 + 100);
        const errorCount = Math.floor(Math.random() * 5);

        updateElement("sensorCollectionCount", sensorCollections);
        updateElement("rfidScanCount", rfidScans);
        updateElement("errorCount", errorCount);
      }

      function testMaintenanceData() {
        console.log("测试维护数据...");

        // 更新统计
        updateElement("totalMaintenanceCount", "10");
        updateElement("scheduledMaintenanceCount", "4");
        updateElement("completedMaintenanceCount", "5");
        updateElement("overdueMaintenanceCount", "1");

        // 生成维护记录
        const mockRecords = [
          {
            device_name: "RFID_READER_001",
            device_type: "RFID设备",
            maintenance_type: "定期检查",
            scheduled_date: "2024-08-06 10:00",
            technician: "张明",
            status: "已完成",
            cost: "150.00",
          },
          {
            device_name: "SENSOR_001",
            device_type: "传感器",
            maintenance_type: "设备校准",
            scheduled_date: "2024-08-07 14:00",
            technician: "李华",
            status: "进行中",
            cost: "100.00",
          },
        ];

        const tbody = document.getElementById("maintenanceTableBody");
        tbody.innerHTML = mockRecords
          .map(
            (record) => `
                <tr>
                    <td>${record.device_name}</td>
                    <td>${record.device_type}</td>
                    <td>${record.maintenance_type}</td>
                    <td>${record.scheduled_date}</td>
                    <td>${record.technician}</td>
                    <td><span class="badge bg-success">${record.status}</span></td>
                    <td>¥${record.cost}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary">查看</button>
                        <button class="btn btn-sm btn-outline-success">编辑</button>
                    </td>
                </tr>
            `
          )
          .join("");
      }

      // 事件绑定
      document.addEventListener("DOMContentLoaded", function () {
        // 暂停采集按钮
        document
          .getElementById("pauseCollectionBtn")
          .addEventListener("click", function () {
            updateElement("collectionStatus", "已暂停", "badge bg-warning");
            this.style.display = "none";
            document.getElementById("resumeCollectionBtn").style.display =
              "block";
            showSuccessMessage("数据采集已暂停");
          });

        // 恢复采集按钮
        document
          .getElementById("resumeCollectionBtn")
          .addEventListener("click", function () {
            updateElement("collectionStatus", "运行中", "badge bg-success");
            this.style.display = "none";
            document.getElementById("pauseCollectionBtn").style.display =
              "block";
            showSuccessMessage("数据采集已恢复");
          });

        // 刷新状态按钮
        document
          .getElementById("refreshStatusBtn")
          .addEventListener("click", testCollectionStatus);

        // 配置表单提交
        document
          .getElementById("collectionConfigForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            showSuccessMessage("配置保存成功");
          });

        // 测试按钮
        document
          .getElementById("loadMaintenanceBtn")
          .addEventListener("click", testMaintenanceData);
        document
          .getElementById("loadCollectionBtn")
          .addEventListener("click", testCollectionStatus);

        // 初始化数据
        testCollectionStatus();
        testMaintenanceData();

        // 定时更新采集状态
        setInterval(testCollectionStatus, 10000);
      });
    </script>
  </body>
</html>
